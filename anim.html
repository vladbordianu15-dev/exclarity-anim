<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Analysis</title>
  <style>
    :root{
      --bg: transparent;
      --cardA: rgba(15, 23, 42, 0.78);
      --cardB: rgba(10, 15, 28, 0.76);
      --line: rgba(255,255,255,0.12);
      --line2: rgba(255,255,255,0.08);
      --text: rgba(245, 247, 252, 0.96);
      --muted: rgba(168, 178, 199, 0.92);

      --a: #7c3aed; /* violet */
      --b: #22c55e; /* green */
      --c: #60a5fa; /* blue */
      --shadow: rgba(0,0,0,0.55);

      --radius: 18px;
    }

    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
    }
    * { box-sizing: border-box; }

    .wrap{
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 14px;
    }

    .card{
      width: min(760px, 100%);
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background: linear-gradient(180deg, var(--cardA), var(--cardB));
      box-shadow: 0 26px 80px var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
      padding: 16px 16px 14px;
    }

    /* ambient glow */
    .glow{
      position:absolute;
      inset:-90px;
      background:
        radial-gradient(600px 380px at 18% 18%, rgba(124,58,237,0.26), transparent 62%),
        radial-gradient(520px 320px at 88% 28%, rgba(34,197,94,0.18), transparent 62%),
        radial-gradient(520px 320px at 70% 110%, rgba(96,165,250,0.12), transparent 60%);
      opacity: 0.95;
      pointer-events:none;
      filter: saturate(1.05);
    }

    /* subtle texture */
    .grain{
      position:absolute;
      inset:-20%;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
      opacity: 0.05;
      pointer-events:none;
      mix-blend-mode: overlay;
      transform: rotate(2deg);
    }

    /* scanline */
    .scanline{
      position:absolute;
      left:-20%;
      top:0;
      width: 140%;
      height: 120px;
      background: linear-gradient(
        90deg,
        transparent 0%,
        rgba(124,58,237,0.00) 28%,
        rgba(124,58,237,0.10) 48%,
        rgba(34,197,94,0.08) 56%,
        rgba(96,165,250,0.04) 62%,
        transparent 100%
      );
      filter: blur(8px);
      opacity: 0.60;
      transform: translateY(-140px);
      animation: scan 3.2s cubic-bezier(.2,.9,.2,1) infinite;
      pointer-events:none;
    }

    @keyframes scan{
      0%{ transform: translateY(-160px); opacity: .0; }
      12%{ opacity: .55; }
      50%{ opacity: .65; }
      88%{ opacity: .45; }
      100%{ transform: translateY(420px); opacity: 0; }
    }

    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      position: relative;
      z-index: 2;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--line2);
      background: rgba(255,255,255,0.04);
      font-size: 12px;
      color: rgba(230,235,248,0.92);
      letter-spacing: .2px;
      white-space: nowrap;
    }

    .dot{
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(124,58,237,0.95), rgba(34,197,94,0.88));
      box-shadow: 0 0 0 3px rgba(124,58,237,0.14);
      animation: pulse 1.35s ease-in-out infinite;
    }
    @keyframes pulse{
      0%, 100%{ transform: scale(1); box-shadow: 0 0 0 3px rgba(124,58,237,0.14); opacity:.9; }
      50%{ transform: scale(1.25); box-shadow: 0 0 0 7px rgba(34,197,94,0.10); opacity:1; }
    }

    .titleBlock{
      display:flex;
      flex-direction:column;
      gap: 6px;
      min-width: 0;
    }

    h1{
      margin:0;
      font-size: 14px;
      font-weight: 900;
      letter-spacing: .25px;
      line-height: 1.15;
      color: var(--text);
      text-shadow: 0 10px 24px rgba(0,0,0,0.35);
    }
    p{
      margin:0;
      font-size: 12.7px;
      color: var(--muted);
      line-height: 1.35;
    }

    .grid{
      margin-top: 12px;
      display:grid;
      gap: 10px;
      position: relative;
      z-index: 2;
    }

    .metric{
      border-radius: 14px;
      border: 1px solid var(--line2);
      background: rgba(255,255,255,0.035);
      padding: 12px 12px 10px;
      position: relative;
      overflow: hidden;
      transform: translateY(8px);
      opacity: 0;
      animation: liftIn .42s ease forwards;
    }
    .metric:nth-child(1){ animation-delay: .05s; }
    .metric:nth-child(2){ animation-delay: .18s; }
    .metric:nth-child(3){ animation-delay: .31s; }
    .metric:nth-child(4){ animation-delay: .44s; }

    @keyframes liftIn{
      to{ transform: translateY(0); opacity: 1; }
    }

    .metric:before{
      content:"";
      position:absolute;
      inset:-40px;
      background: radial-gradient(420px 160px at 10% 30%, rgba(124,58,237,0.10), transparent 65%);
      opacity: 0;
      transition: opacity .25s ease;
      pointer-events:none;
    }
    .metric.on:before{ opacity: 1; }

    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 8px;
    }
    .label{
      font-size: 12.6px;
      font-weight: 800;
      color: rgba(235,238,245,0.92);
      letter-spacing: .15px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 0;
    }
    .state{
      font-size: 11.5px;
      color: rgba(235,238,245,0.68);
      white-space: nowrap;
      display:flex;
      align-items:center;
      gap: 6px;
    }
    .spark{
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(235,238,245,0.55);
      opacity: .35;
      animation: ping 1.2s infinite ease-in-out;
    }
    .metric.on .spark{ opacity: 1; background: rgba(34,197,94,0.75); }
    @keyframes ping{
      0%,100%{ transform: translateY(0); opacity: .35; }
      50%{ transform: translateY(-2px); opacity: .95; }
    }

    .track{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      overflow:hidden;
      position: relative;
    }

    .fill{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(124,58,237,0.98), rgba(34,197,94,0.90));
      transition: width 1.25s cubic-bezier(.2,.95,.2,1);
      position: relative;
    }

    /* glossy sweep */
    .fill:after{
      content:"";
      position:absolute;
      top:-40%;
      left:-28%;
      width: 34%;
      height: 180%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
      transform: skewX(-18deg);
      opacity: .0;
      animation: sheen 1.7s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes sheen{
      0%{ transform: translateX(-40%) skewX(-18deg); opacity: 0; }
      15%{ opacity: .25; }
      55%{ opacity: .18; }
      100%{ transform: translateX(420%) skewX(-18deg); opacity: 0; }
    }

    .footer{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      position: relative;
      z-index: 2;
    }

    /* updated: fade-in instruction text after animation finishes */
    .small{
      font-size: 12px;
      color: rgba(235,238,245,0.68);
      opacity: 0;
      transition: opacity .4s ease;
    }
    .small.show{
      opacity: 1;
    }

    .checks{
      display:flex;
      gap: 8px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .chip{
      font-size: 11.5px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.035);
      color: rgba(235,238,245,0.75);
      opacity: .55;
      transition: opacity .25s ease, transform .25s ease, border-color .25s ease, background .25s ease;
      white-space:nowrap;
    }
    .chip.on{
      opacity: 1;
      transform: translateY(-1px);
      border-color: rgba(124,58,237,0.35);
      background: rgba(124,58,237,0.10);
      color: rgba(235,238,245,0.92);
    }

    @media (max-width: 520px){
      .card{ padding: 14px; border-radius: 16px; }
      .badge{ font-size: 11.5px; padding: 7px 9px; }
      h1{ font-size: 13.5px; }
      p{ font-size: 12.4px; }
      .label{ font-size: 12.4px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="glow"></div>
      <div class="grain"></div>
      <div class="scanline"></div>

      <div class="top">
        <div class="titleBlock">
          <h1 id="title">Mapping Emotional Signals</h1>
          <p id="desc">Calibrating your emotional profile based on your responses.</p>
        </div>

        <div class="badge" aria-label="status">
          <span class="dot"></span>
          <span id="statusText">Calibrating</span>
        </div>
      </div>

      <div class="grid" id="grid"></div>

      <div class="footer">
        <div class="small" id="footNote">Signals identified. Preparing the next section…</div>
        <div class="checks" id="chips">
          <div class="chip on">Signal Mapping</div>
          <div class="chip">Pattern Match</div>
          <div class="chip">Stability Check</div>
          <div class="chip">Clarity Baseline</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // -------------------------
    // URL PARAMS (optional)
    // title, desc
    // s1..s4 labels
    // v1..v4 values (0-100)
    // duration (ms) optional (controls stagger spacing only)
    // -------------------------
    const q = new URLSearchParams(window.location.search);

    const title = q.get("title") || "Mapping Emotional Signals";
    const desc  = q.get("desc")  || "Calibrating your emotional profile based on your responses.";
    document.getElementById("title").textContent = title;
    document.getElementById("desc").textContent  = desc;

    // defaults (consumer-safe, professional, non-judgmental)
    const labels = [
      q.get("s1") || "Emotional Intensity",
      q.get("s2") || "Rumination Loop",
      q.get("s3") || "Attachment Sensitivity",
      q.get("s4") || "Emotional Reactivity"
    ];

    // default values are tasteful (numbers are NOT shown)
    const values = [
      clamp(parseInt(q.get("v1") || "76", 10)),
      clamp(parseInt(q.get("v2") || "68", 10)),
      clamp(parseInt(q.get("v3") || "61", 10)),
      clamp(parseInt(q.get("v4") || "54", 10))
    ];

    const baseDelay = clampMs(parseInt(q.get("duration") || "0", 10)); // optional

    function clamp(n){
      if (Number.isNaN(n)) return 60;
      return Math.max(0, Math.min(100, n));
    }
    function clampMs(n){
      if (Number.isNaN(n)) return 0;
      return Math.max(0, Math.min(12000, n));
    }

    function levelText(v){
      if (v >= 78) return "High";
      if (v >= 62) return "Elevated";
      if (v >= 45) return "Moderate";
      return "Low";
    }

    const grid = document.getElementById("grid");

    // Build metrics
    labels.forEach((lab, idx) => {
      const v = values[idx];
      const el = document.createElement("div");
      el.className = "metric" + (idx === 0 ? " on" : "");
      el.innerHTML = `
        <div class="row">
          <div class="label" title="${escapeHtml(lab)}">${escapeHtml(lab)}</div>
          <div class="state"><span class="spark"></span><span>${levelText(v)}</span></div>
        </div>
        <div class="track"><div class="fill" data-v="${v}"></div></div>
      `;
      grid.appendChild(el);
    });

    // Animate fills (staggered)
    const fills = Array.from(document.querySelectorAll(".fill"));
    const metrics = Array.from(document.querySelectorAll(".metric"));

    const delays = baseDelay
      ? [0, baseDelay * 0.18, baseDelay * 0.36, baseDelay * 0.54]
      : [120, 280, 440, 600];

    setTimeout(() => {
      fills.forEach((f, i) => {
        setTimeout(() => { f.style.width = (f.dataset.v || 60) + "%"; }, delays[i] || 0);
      });
    }, 40);

    // Cycle highlight for “calibrating” feel
    let hi = 0;
    setInterval(() => {
      metrics.forEach(m => m.classList.remove("on"));
      metrics[hi % metrics.length].classList.add("on");
      hi++;
    }, 520);

    // Cycle chip highlight
    const chips = Array.from(document.querySelectorAll(".chip"));
    let ci = 0;
    setInterval(() => {
      chips.forEach(c => c.classList.remove("on"));
      chips[ci % chips.length].classList.add("on");
      ci++;
    }, 560);

    // Status text rotate
    const status = document.getElementById("statusText");
    const statuses = ["Calibrating", "Analyzing", "Mapping", "Finalizing"];
    let si = 0;
    setInterval(() => {
      si++;
      status.textContent = statuses[si % statuses.length];
    }, 900);

    // ✅ show instruction text after animation completes (you already have Next button below)
    // tweak time if you want: 3200 faster, 4000 slower
    setTimeout(() => {
      const note = document.getElementById("footNote");
      note.textContent = "Emotional signal mapping is complete. Click “Next” to continue.";
      note.classList.add("show");
    }, 3600);

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
  </script>
</body>
</html>
